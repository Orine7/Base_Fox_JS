"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const schematics_1 = require("@angular-devkit/schematics");
const workspace_1 = require("@nrwl/workspace");
const path_1 = require("path");
const require_shim_1 = require("../../utils/require-shim");
const { CONFIG_FILE, CONFIG_FILES } = (0, require_shim_1.importConstants)();
const defaultConfig = `const withSass = require('@zeit/next-sass');
const withLess = require('@zeit/next-less');
const withStylus = require('@zeit/next-stylus');
const withCSS = require('@zeit/next-css');

/*
 * This file was generated by Nx 9.2.0 to allow greater control over configuration
 * for Next apps. To optimize your configuration please update the following export
 * with only the style plugin you are using.
 *
 * e.g. module.exports = withCSS({ cssModules: false });
 */
module.exports = withStylus(withLess(withSass(withCSS({
  // Set this to true if you use CSS modules.
  // See: https://github.com/css-modules/css-modules
  cssModules: false
}))));
`;
function update() {
    return (0, schematics_1.chain)([
        (host) => {
            const workspaceJson = (0, workspace_1.readWorkspace)(host);
            const nextProjects = Object.keys(workspaceJson.projects)
                .map((name) => {
                const p = workspaceJson.projects[name];
                const buildBuilder = p.architect && p.architect.build && p.architect.build.builder;
                return buildBuilder === '@nrwl/next:build' ? p : null;
            })
                .filter(Boolean);
            nextProjects.forEach((p) => {
                // Next.js 12 specifies two config files.
                const configFile = Array.isArray(CONFIG_FILES)
                    ? CONFIG_FILES[0]
                    : CONFIG_FILE;
                const configPath = (0, path_1.join)(p.root, configFile);
                if (!host.exists(configPath)) {
                    host.create(configPath, defaultConfig);
                }
            });
        },
        (0, workspace_1.formatFiles)(),
    ]);
}
exports.default = update;
//# sourceMappingURL=create-next-config.js.map